if(!navigator.onLine){console.log('Offline');store_name='articulos';var dbRequest=indexedDB.open('COMEX_PRUEBA');dbRequest.onsuccess=function(event){var db=this.result;var db=dbRequest.result;var db=event.target.result;$('.ver_mas').css("display","none");console.log('Got a db connection! It is %s',db);var myTransaction=db.transaction([store_name],'readwrite');var myObjectStore=myTransaction.objectStore([store_name]);var cursor=event.target.result;myTransaction.objectStore(store_name).openCursor(IDBKeyRange.lowerBound(0)).onsuccess=function(event){var cursor=event.target.result;if(null!==cursor){var tam=cursor.value.length;var val=cursor.value;for(var i=0;i<tam;i++){var numTag=val[i].tags.length;console.log(numTag);var tag="";for(var x=0;x<numTag;x++){tag+='<li class="lista-tag-li">'+val[i].tags[x]+'</li>'}
var contenido='<div class="col-md-12 col-xs-12 leftcero rightcero whole-cont-art">'+'<div class="cont-articulos">'+'<div class="col-md-12 col-xs-12 contenedor-articulo">'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'<div class="col-md-5 col-sm-7 col-xs-7 ancho leftcero">'+'<div class=lista-tag>'+tag+'</div>'+'<a href="'+val[i].link+'">'+'<p class="titulo-plomo20">'+val[i].title+'</p>'+'</a>'+'<p class="parrafo14-art">'+val[i].content+'</p>'+'<p class="text12"> Por '+val[i].creado_por.bold()+' / '+'<span class="fecha-black">'+val[i].fecha+' / '+'</span>'+'<a href="#">'+'<span class="publi-rojo">'+'DATACOMEX N° 052'+'</span>'+'</a>'+'</p>'+'<div class="">'+'<a class="btn-leermas" href="'+val[i].link+'">LEER MÁS</a>'+'</div>'+'</div>'+'<div class="col-md-3 col-sm-3 col-xs-5 articulos-resp nopadding" align="right">'+'<div class="foto-articulo2">'+'<a href="'+val[i].link+'">'+'<img src="'+val[i].image+'" class="image-responsive" alt=""/>'+'</a>'+'</div>'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'</div>'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'</div>'+'</div>'+'</div>'
$('.articulos-container-all').append(contenido)}}}}}
var xhr=null;var articulo=function(){return{init:function(url,data){if(xhr&&xhr.readyState!=4){xhr.abort()}
var armar=function(url,data){indexedDB=data;$('.articulos-container-all').append('<span class="cargando col-md-12 col-xs-12  text-center"><img src="css/ajax-loader.gif" alt=""> cargando...</span></div>');xhr=$.ajax({type:"POST",url:url+'/getarticles',data:data,success:function(data){$('.articulos-container-all').find('.cargando').remove();var numArticulos=data.data.length;var articulos=data.data;for(var i=0;i<numArticulos;i++){$(".btn-leermas[href*='.pdf'],a[href*='.html']").each(function(){$(this).attr('target','_blank')});var numTag=articulos[i].tags.length;var tag="";for(var x=0;x<numTag;x++){tag+='<li class="lista-tag-li">'+articulos[i].tags[x]+'</li>'}
var publicacion="";if(articulos[i].edition==null){publicacion+='<span class="publi-rojo">'+articulos[i].publications+'</span>'}else{publicacion+='<span class="publi-rojo">'+articulos[i].publications+' '+articulos[i].edition+'</span>'}
var autor="";if(articulos[i].creado_por!=null&&articulos[i].creado_por!=""){autor+='<p class="text12"> '+realizadopor+' '+articulos[i].creado_por.bold()+' / '}else{autor+='<p class="text12"> '}
var articulo_img="";if(articulos[i].image!=null&&articulos[i].image!=""){articulo_img+='<img src="'+articulos[i].image+'" class="image-responsive" alt=""/>'}
var contenido='<div class="col-md-12 col-xs-12 leftcero rightcero whole-cont-art">'+'<div class="cont-articulos">'+'<div class="col-md-12 col-xs-12 contenedor-articulo">'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'<div class="col-md-5 col-sm-7 col-xs-7 ancho leftcero">'+'<ul class=lista-tag>'+tag+'</ul>'+'<a href="'+articulos[i].link+'">'+'<p class="titulo-plomo20">'+articulos[i].title+'</p>'+'</a>'+'<p class="parrafo14-art">'+articulos[i].content+'</p>'+autor+'<span class="fecha-black">'+articulos[i].fecha+' / '+'</span>'+'<a href="'+articulos[i].linkpublic+'" >'+publicacion+'</a>'+articulos[i].columna+'</p>'+'<div class="">'+'<a class="btn-leermas" href="'+articulos[i].link+'" >LEER MÁS</a>'+'</div>'+'</div>'+'<div class="col-md-3 col-sm-3 col-xs-5 articulos-resp nopadding" align="right">'+'<div class="foto-articulo2">'+'<a href="'+articulos[i].link+'">'+articulo_img+'</a>'+'</div>'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'</div>'+'<div class="col-md-2 col-sm-1 hidden-xs">'+'</div>'+'</div>'+'</div>'+'</div>'
$('.articulos-container-all').append(contenido)}
$('.ver_mas').removeAttr('data-next');$('.ver_mas').attr('data-next',data.next_page);var next=data.next_page;if(next==null){$('.ver_mas').css("display","none")}else{$('.ver_mas').css("display","block")}
if(numArticulos==0){$('.articulos-container-all').append('<span class="alert alert-danger col-md-12 col-xs-12 text-center">'+texto+'</span></div>')}
var db_name='COMEX_PRUEBA',store_name='articulos';var entry=data.data;var request,upgrade=!1,doTx=function(db,entry){addData(db,entry,function(){getData(db)})},getData=function(db){db.transaction([store_name],"readonly").objectStore(store_name).openCursor(IDBKeyRange.lowerBound(0)).onsuccess=function(event){var cursor=event.target.result;if(null!==cursor){cursor.continue()}}},addData=function(db,entry,finished){var tx=db.transaction([store_name],"readwrite"),user=[];tx.addEventListener('complete',function(e){finished()});tx.objectStore(store_name).add(entry)};request=window.indexedDB.open(db_name);request.oncomplete=function(event){if(upgrade){doTx(request.result,entry)}};request.onsuccess=function(event){if(!upgrade){doTx(request.result,entry)}};request.onupgradeneeded=function(event){var db=event.target.result;db.createObjectStore(store_name,{keyPath:null,autoIncrement:!0})}},error:function(){$('.articulos-container-all').empty();$('.articulos-container-all').append('<span class="alert alert-danger col-md-12 col-xs-12  text-center">Sin conexión</span></div>')}})};armar(url,data)}}}();function filtroTag(){var concatenar='';$('.filtro-lista-active').each(function(){tag=$(this).attr('data-id');concatenar+=','+tag});concatenar=concatenar.slice(1);return concatenar}
function filtroCategorias(){var categorias='';$('.lista-ver-active').each(function(){idCategorias=$(this).attr('data-id');categorias+=','+idCategorias});categorias=categorias.slice(1);return categorias}
function fncconcatenarfiltros()
{var concatenar='';var i=0;$('.filtro-lista-active').each(function(){if(i==0){concatenar+="&tags="+$(this).attr('data-id')}
else{concatenar+=','+$(this).attr('data-id')}
i++});var i=0;$('.lista-ver-active').each(function(){if(i==0){concatenar+="&categorias="+$(this).attr('data-id')}
else{concatenar+=','+$(this).attr('data-id')}
i++});var keyword=$('.filtro-contenido').find('.home-input-search').val();if(keyword!=''){concatenar+="&keyword="+keyword}
var fecha=$('.seccion-ordenar .selectpicker').val();if(fecha!=''){concatenar+="&fecha="+fecha}
return concatenar}
function ejecutarfiltros()
{var pagina=$('.ver_mas').attr('data-next');var page=window.location.hash.replace('?page=','');if(page==Number.NaN||page<=0)
{var page=1;if(fncconcatenarfiltros().toString().length>0)
{page='';var filtros_string=fncconcatenarfiltros();page="1".concat(filtros_string.toString())}
window.history.replaceState(null,null,url+"/"+ruta+"articulos?page="+page)}}
$(document).on('click','.home-button-buscar',function(e){$('.articulos-container-all').empty();var fecha=$('.seccion-ordenar .selectpicker').val();ejecutarfiltros();var keyword=$('.filtro-contenido').find('.home-input-search').val();var data={};data._token=$('.ttoken').val();data.tags=filtroTag();data.categorias=filtroCategorias();data.keyword=keyword;data.fecha=fecha;data.idioma=idioma;articulo.init(url,data);$('body,html').stop(!0,!0).animate({scrollTop:$('#ancla').offset().top},1)});$(document).on('click','.ver_mas',function(event){var keyword=$('.filtro-contenido').find('.home-input-search').val();var fecha=$('.seccion-ordenar .selectpicker').val();var data={};data._token=$('.ttoken').val();data.page=$(this).attr('data-next');data.tags=filtroTag();data.categorias=filtroCategorias();data.keyword=keyword;data.fecha=fecha;data.idioma=idioma;articulo.init(url,data)});$(".selectpicker").change(function(){$('.home-button-buscar').click()})
